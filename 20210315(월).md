> # 1. 학습 날짜
- **2021년 03월 15일 월요일**

<br />

> # 2. 학습시간 (4 시간)
- **20:00 ~ 24:00 (4 시간)** 집

<br />

> # 3. 학습 범위 및 주제
- **레포트 TOC 생성기**

<br />

> # 4. 동료 학습 방법
- **20:00 ~ 24:00** 자가 학습

<br />

> # 5. 학습 동기 및 목표
- 레포트 TOC 생성기
    - `nodejs`로 레포트 TOC(Table Of Contents)를 생성하는 스크립트 작성함으로써 이전 레포트를 빠르게 탐색할 수 있도록 함

<br />

> # 6. 상세 학습 내용
- 실제 코딩에 사용한 시간: **4 시간**

<br />

> ## 작성한 코드 및 코드 설명

```js
'use strict'    // ES6(ECMAScript 5) 이후의 엄격모드를 활성화하기 위한 선언

const fs = require('fs-extra')  // nodejs의 내장 fs 라이브러리를 Promisify한 버전
const path = require('path')    // 경로 관련 nodejs 내장 라이브러리
const chalk = require('chalk')  // 터미널에 예쁘게 출력하기 위한 외부 라이브러리

/* 한 디렉토리 내의 모든 파일 목록들을 반환하는 함수 */
async function getFiles(dir)
{
    /* 디렉토리를 읽어 변수 subdirs에 파일 목록들을 저장한다 */
    const subdirs = await fs.readdir(dir)

    /* 재귀적으로 getFiles를 활용하는 부분 */
    const files = await Promise.all(subdirs.map(async (subdir) =>   // subdirs의 모든 엔트리에 대해 실행하는 콜백 함수를 정의한다
                                                                    // map의 콜백함수가 async 함수이기 때문에 모두 Promise 객체를 반환한다
                                                                    // 때문에 해당 Promise들을 취합하여 한번에 await 할 수 있도록 Promise.all로 묶어 await 해준다
    {
        const res = path.resolve(dir, subdir)                               // dir과 subdir을 합쳐 res로 resolve한다
        return ((await fs.stat(res)).isDirectory() ? getFiles(res) : res)   // res가 디렉토리면 getFiles를 호출하여 반환한다
    }))

    /* 배열을 펼쳐 반환한다 */
    return (files.reduce((a, f) => a.concat(f), []))
}

async function extractHeading(filename, idx)
{
    try
    {
        /* 파일을 읽어서 텍스트 형태로 text 변수에 저장한다 */
        const text = await (await fs.readFile(filename)).toString()

        /* 헤딩 규칙 */
        const heading = (idx) => `> # ${idx}`

        /* 헤딩을 추출하는 정규표현식 */
        /* 생각하면 할수록 정규표현식을 알면 삶이 참 편해지는 것 같다 */
        const regex_pattern = new RegExp(`(?:${heading(idx)}[^\\n]*)([\\s|\\S]*?)(?:${heading(idx + 1)})`)

        /* 앞선 정규표현식에 따라 텍스트를 추출하고 정리정돈 한다 */
        const text_extracted =
            text.match(regex_pattern)[1]
                .trim()
                .replace(/<br \/>$/, '')
                .trim()

        /* 추출된 데이터 리턴 */
        return (text_extracted)
    }
    catch (e)
    {
        console.log(e)
    }
}

/* C언어에서 main함수와 같은 기능을 하는 함수; 엔트리포인트 느낌이다 */
/* 함수 이름이 메인 함수일 필요는 없지만 (익명함수여도 상관 없다) 이런 식으로 작성하는 걸 선호하는 편이다 */
/* 맨 앞의 느낌표는 함수를 선언(declaration)이 아닌 표현식(expression)으로 해석하기 위한 것이다 */
!async function main()
{
    /* wiki 폴더 내의 모든 파일들을 files 변수에 저장한다 */
    const files = await getFiles('wiki')
    /* 확장명이 .md이고 앞의 8글자가 숫자인 형식을 따르는 파일만 필터링한다 */
    const markdowns = files.filter(
        filename => (path.extname(filename) == '.md') && (/\d{8}/.test(filename))
    )

    /* 앞서 Promise.all, map을 활용한 것과 유사한 부분 */
    /* 파일이름(filename)과 헤딩으로부터 추출된 date, topic, goal 프로퍼티를 갖는 객체의 배열을 만든다 */
    const markdowns_parsed = await Promise.all(markdowns.map(async filename =>
    {
        return {
            filename,   // filename: (filename 변수 내용)
            date: await extractHeading(filename, 1),
            topic: await extractHeading(filename, 3),
            goal: await extractHeading(filename, 5)
        }
    }))

    /* 파일이름을 기준으로 정렬한다 */
    markdowns_parsed.sort((a, b) => (a.filename > b.filename ? 1 : -1))

    /* markdowns_parsed 배열의 요소마다 콜백함수를 반복한다 */
    markdowns_parsed.forEach(md =>
    {
        /* 형식에 따라 출력 */
        console.log(chalk.cyan(md.date))
        console.log('\n')
        console.log(md.topic)
        console.log('\n')
        console.log(md.goal)
        console.log(chalk.green('-'.repeat(process.stdout.columns)))
    })
}() // 표현식으로 작성된 함수는 다음과 같이 바로 호출할 수 있다
```

<br />

> ## 실제 출력된 모습
![]('markdown-toc.png)

<br />

- ## 참고 자료
    - [Mozilla JavaScript Reference](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference)

<br />

> # 7. 학습 내용에 대한 개인적인 총평

&emsp;레포트를 쓰다 보면 그동안 무슨 내용을 써 왔는지 궁금할 때가 있다. 또 레포트를 한번 쓰고 그만인 것이 아니라 공부한 뒤에 기억이 나지 않는 부분은 이전에 공부했던 레포트를 가지고 다시 찾아볼 때가 많이 있었다. 그런데 레포트 수가 많아지니 이전 레포트 들에서 어떤 내용을 찾는 것이 점점 더 힘들어졌다. 그렇게 그동안 작성한 레포트 들에 대한 목차를 생성하는 스크립트를 작성하게 되었다.
<br />

&emsp;원래 개인적으로 사용하는 웹페이지나 api 등의 서비스들을 `nodejs`라는 서버사이드 js 플랫폼을 이용해 만들곤 했어서 나에게 이런 스크립트를 만드는 데에는 `nodejs`를 사용하는 게 편했다. 또한 `C`나 `C++` 같은 언어보다는 `js`를 사용하는 게 내 머릿속에 있는 로직을 표현하기가 용이하기 때문에 개발 속도가 더욱 빠르기도 하다.
<br />

&emsp;만든 스크립트가 아직은 터미널 상에 간단하게 출력하는 수준에 그쳐서 부족한 부분이 많지만 추후에는 처리된 데이터를 가지고 TOC 마크다운을 만드는 기능을 구현할 생각이다.

<br />

> # 8. 다음 학습 계획
- *ft_printf*
    - 소수형 숫자 출력 구현

<br />

- *miniRT*
    - 반사광 개선
    - 퐁 쉐이딩
